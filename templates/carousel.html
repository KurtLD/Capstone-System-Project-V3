{% load static %}
{% load widget_tweaks %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Information</title>
    
    <!-- Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- CSS Libraries -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'carousel.css' %}">
</head>
<body>
    {% if error_message %}
        <script>
            alert("{{ error_message }}");
        </script>
    {% endif %}
    <div class="flex h-screen flex-col">
        <!-- Navbar -->
        <div class="no-print">
            {% include 'navbar.html' %}
        </div>
        <div class="flex flex-1 overflow-hidden">
            <!-- Sidebar -->
            {% include 'sidebar.html' %}
            <!-- Main Content Wrapper -->
            <div class="flex flex-col flex-1">
                <!-- Content -->
            <main class="flex-1 overflow-auto p-6 main-content">
                <!-- Title Hearing Details Table -->
                <div class="dropdown no-print">
                    <select class="form-selects" id="groupSelector" onchange="displaySelectedTableById(this.value);">
                        <option value="title-hearing-details">Title Hearing Groups</option>
                        <option value="preoral-details">Pre-Oral Groups</option>
                        <option value="mock-defense-details">Mock Groups</option>
                        <option value="final-defense-details">Final Groups</option>
                    </select>
                </div>
                <script>
                    function displaySelectedTableById(selectedId) {
                        const tableContainers = document.querySelectorAll('.card');
                
                        tableContainers.forEach(container => {
                            container.style.display = 'none';
                        });
                
                        if (selectedId) {
                            document.getElementById(selectedId).style.display = 'block';
                        }
                    }
                </script>
                <div class="card mt-3 p-4 shadow-lg" id="title-hearing-details">
                    <div id="title-hearing-details" class="details-section">
                        <h2 class="text-center mb-4 title-heading">Title Hearing Details</h2>
                        <div class="parent-container">
                            <input type="text" id="searchTitleHearing" class="search-bar" placeholder="Search..." onkeyup="searchTable('title-hearing-details', 'searchTitleHearing')">
                        </div>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Group Members</th>
                                    <th>Section</th>
                                    {% comment %} <th>Subject Teacher</th> {% endcomment %}
                                    <th>Panelists</th>
                                    {% if selected_school_year == last_school_year %}
                                        <th>Actions</th>
                                    {% endif %}
                                    
                                </tr>
                            </thead>
                            <tbody>
                                {% for group in group_info_list %}
                                <tr>
                                    <td data-label="Group Members">
                                        {{ group.member1 }}<br>
                                        {{ group.member2 }}<br>
                                        {{ group.member3 }}
                                    </td>
                                    <td data-label="Section">{{ group.section }}</td>
                                    {% comment %} <td>{{ group.subject_teacher.name }}</td> {% endcomment %}
                                     <td class="panels" data-label="Panelists">
                                        {% with schedule=group_schedules|get_item:group.id %}
                                            {% if schedule %}
                                                <div>
                                                    {{ schedule.faculty1.name }} {% if schedule.faculty1 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                </div>
                                                <div>
                                                    {{ schedule.faculty2.name }} {% if schedule.faculty2 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                </div>
                                                <div>
                                                    {{ schedule.faculty3.name }} {% if schedule.faculty3 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                </div>
                                            {% else %}
                                                No schedule assigned
                                            {% endif %}
                                        {% endwith %}
                                    </td>
                                    {% if selected_school_year == last_school_year %}
                                    <td data-label="Action">
                                        <div>
                                            <button class="btn btn-warning btn-sm" data-toggle="modal" data-target="#editModal-{{ group.id }}" data-id="{{ group.id }}">Edit</button>
                                            <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deleteModal-{{ group.id }}" data-id="{{ group.id }}">Delete</button>
                                        </div> 
                                    </td>
                                    {% endif %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <div class="pagination" id="pagination-group-info-list">
                            <span class="step-links">
                                {% if group_info_list.has_previous %}
                                    <a href="?page_group_info_list=1&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoMD={{ group_infoMD.number }}&page_group_infoFD={{ group_infoFD.number }}">&laquo;</a>
                                    <a href="?page_group_info_list={{ group_info_list.previous_page_number }}&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoMD={{ group_infoMD.number }}&page_group_infoFD={{ group_infoFD.number }}">&lsaquo;</a>
                                {% endif %}
                                <span class="current">
                                    Page {{ group_info_list.number }} of {{ group_info_list.paginator.num_pages }}
                                </span>
                                {% if group_info_list.has_next %}
                                    <a href="?page_group_info_list={{ group_info_list.next_page_number }}&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoMD={{ group_infoMD.number }}&page_group_infoFD={{ group_infoFD.number }}">&rsaquo;</a>
                                    <a href="?page_group_info_list={{ group_info_list.paginator.num_pages }}&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoMD={{ group_infoMD.number }}&page_group_infoFD={{ group_infoFD.number }}">&raquo;</a>
                                {% endif %}
                            </span>
                        </div>
                        <a href="{% url 'checker1' %}" class="btn btn-secondary">View Title Hearing Schedule</a>
                    </div>
                </div>
                                
                <!-- Modals -->
                
                {% for group in group_info_list %}
                    <!-- Edit Modal -->
                    <div class="modal fade" id="editModal-{{ group.id }}" tabindex="-1" role="dialog" aria-labelledby="editModalLabel-{{ group.id }}" aria-hidden="true"data-backdrop="static" data-keyboard="false">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editModalLabel-{{ group.id }}">
                                        <i class="fa fa-pencil-alt" style="color: #007bff;"></i> Edit Group
                                    </h5>
                                    {% comment %} <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button> {% endcomment %}
                                </div>
                                <div class="modal-body">
                                    <form id="editFormTH-{{ group.id }}" method="post" action="{% url 'update_group' group.id %}">
                                        {% csrf_token %}
                                        <div class="form-group">
                                            <label for="section">Section</label>
                                            <input type="text" class="form-control" id="section" name="section" value="{{ group.section }}" placeholder="Enter section" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="subject_teacher">Subject Teacher</label>
                                            <select class="form-control" id="subject_teacher" name="subject_teacher" required onchange="updatePanelists({{ group.id }}, this.value)">
                                                {% for teacher in teachers %}
                                                    <option value="{{ teacher.id }}" {% if teacher.id == group.subject_teacher.id %}selected{% endif %}>
                                                        {{ teacher.name }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="member1">Member 1</label>
                                            <input type="text" class="form-control" id="member1" name="member1" value="{{ group.member1 }}" placeholder="(e.g., Delacruz, Juan T.)" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="member2">Member 2</label>
                                            <input type="text" class="form-control" id="member2" name="member2" value="{{ group.member2 }}" placeholder="(e.g., Delacruz, Juan T.)" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="member3">Member 3</label>
                                            <input type="text" class="form-control" id="member3" name="member3" value="{{ group.member3 }}" placeholder="(e.g., Delacruz, Juan T.)" required>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="resetForm({{ group.id }}, 'TH')">Discard Changes</button>
                                            <button type="submit" class="btn btn-modal">Apply Changes</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Delete Confirmation Modal -->
                    <div class="modal fade" id="deleteModal-{{ group.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel-{{ group.id }}" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title custom-3d-title" id="deleteModalLabel-POD-{{ group.id }}">
                                        <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i> Confirm Delete
                                    </h5>
                                    {% comment %} <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button> {% endcomment %}
                                </div>
                                <div class="modal-body">
                                    Are you sure you want to delete this group?
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">No, Keep it.</button>
                                    <a href="{% url 'delete_group' group.id %}" class="btn btn-danger">Yes, Delete!</a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}

                    <!-- Pre-Oral Details Table -->
                    <div class="card mt-3 p-4 shadow-lg" id="preoral-details" style="display: none;">
                        <div id="preoral-details" class="details-section">
                            <h2 class="text-center mb-4 title-heading">Pre-Oral Details</h2>
                            <div class="parent-container">
                                <input type="text" id="searchPreOral" class="search-bar" placeholder="Search..." onkeyup="searchTable('preoral-details', 'searchPreOral')">
                            </div>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Capstone Teacher</th>
                                        <th>Section</th>
                                        <th>Members</th>
                                        <th>Adviser</th>
                                        <th>Title</th>
                                        <th>Panelist</th>
                                        {% if selected_school_year == last_school_year %}
                                            <th>Action</th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for group in group_infoPOD %}
                                        <tr>
                                            <td data-label="Capston Teacher">{{ group.capstone_teacher.name }}</td>
                                            <td data-label="Section">{{ group.section }}</td>
                                            <td data-label="Group Members">
                                                {{ group.member1 }}<br />
                                                {{ group.member2 }}<br />
                                                {{ group.member3 }}
                                            </td>
                                            <td data-label="Adviser">{{ group.adviser.name }}</td>
                                            <td>{{ group.title }}</td>
                                            <td class="panels" data-label="Panelists">
                                                {% with schedule=group_schedules_pod|get_item:group.id %}
                                                    {% if schedule %}
                                                    <div style="background-color: #5b97f8; padding: 3px; display: inline-block; border-radius: 3px;font-weight: bold;">
                                                            {{ schedule.faculty1.name }} {% if schedule.faculty1 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                        </div>
                                                        <div style="padding: 3px;">
                                                            {{ schedule.faculty2.name }} {% if schedule.faculty2 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                        </div>
                                                        <div style="padding: 3px;">
                                                            {{ schedule.faculty3.name }} {% if schedule.faculty3 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                        </div>
                                                    {% else %}
                                                        No panelists assigned
                                                    {% endif %}
                                                {% endwith %}
                                            </td>
                                            {% if selected_school_year == last_school_year %}
                                            <td data-label="Action" class="btn">
                                                <div style="display: flex; gap: 5px; justify-content: center;">
                                                    <button class="btn btn-warning btn-sm" data-toggle="modal" data-target="#editModal-POD-{{ group.id }}" data-id="{{ group.id }}">Edit</button>
                                                    <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deleteModal-POD-{{ group.id }}" data-id="{{ group.id }}">Delete</button>
                                                </div>
                                            </td>
                                            {% endif %}
                                        </tr>

                                        
                                        <!-- Edit Modal -->
                                        <div class="modal fade" id="editModal-POD-{{ group.id }}" tabindex="-1" role="dialog" aria-labelledby="editModalLabel-POD-{{ group.id }}" aria-hidden="true"data-backdrop="static" data-keyboard="false">
                                            <div class="modal-dialog modal-dialog-centered" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="editModalLabel-POD-{{ group.id }}">
                                                            <i class="fas fa-pencil-alt" style="color: #10B981; margin-right: 10px;"></i>Edit Group
                                                        </h5>
                                                        {% comment %} <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button> {% endcomment %}
                                                    </div>
                                                    <div class="modal-body">
                                                        <form id="editFormPOD-{{ group.id }}" method="post" action="{% url 'update_groupPOD' group.id %}">
                                                            {% csrf_token %}
                                                            {% with forms|get_item:group.id as form %}
                                                                <div class="form-group">
                                                                    <label for="{{ form.member1.id_for_label }}">Member 1:</label>
                                                                    {{ form.member1|add_class:"form-control" }}
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="{{ form.member2.id_for_label }}">Member 2:</label>
                                                                    {{ form.member2|add_class:"form-control" }}
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="{{ form.member3.id_for_label }}">Member 3:</label>
                                                                    {{ form.member3|add_class:"form-control" }}
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="{{ form.title.id_for_label }}">{{ form.title.label }}:</label>
                                                                    {{ form.title|add_class:"form-control custom-textarea" }}
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="{{ form.capstone_teacher.id_for_label }}">{{ form.capstone_teacher.label }}:</label>
                                                                    {{ form.capstone_teacher|add_class:"form-control" }}
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="{{ form.section.id_for_label }}">{{ form.section.label }}:</label>
                                                                    {{ form.section|add_class:"form-control" }}
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="{{ form.adviser.id_for_label }}">{{ form.adviser.label }}:</label>
                                                                    {{ form.adviser|add_class:"form-control" }}
                                                                </div>
                                                            {% endwith %}
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="resetForm({{ group.id }}, 'POD')">Discard Changes</button>
                                                                <button type="submit" class="btn btn-modal">Apply Changes</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Delete Confirmation Modal -->
                                        <div class="modal fade" id="deleteModal-POD-{{ group.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel-POD-{{ group.id }}" aria-hidden="true"data-backdrop="static" data-keyboard="false">
                                            <div class="modal-dialog modal-dialog-centered" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title custom-3d-title" id="deleteModalLabel-POD-{{ group.id }}">
                                                            <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i> Confirm Delete
                                                        </h5>
                                                        {% comment %} <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button> {% endcomment %}
                                                    </div>
                                                    <div class="modal-body">
                                                        Are you sure you want to delete this group?
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">No, Keep it.</button>
                                                        <a href="{% url 'delete_groupPOD' group.id %}" class="btn btn-danger">Yes, Delete!</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </tbody>
                            </table>
                            <div class="pagination" id="pagination-group-info-POD">
                                <span class="step-links">
                                    {% if group_infoPOD.has_previous %}
                                        <a href="?page_group_infoPOD=1&page_group_info_list={{ group_info_list.number }}&page_group_infoMD={{ group_infoMD.number }}&page_group_infoFD={{ group_infoFD.number }}#preoral-details">&laquo;</a>
                                        <a href="?page_group_infoPOD={{ group_infoPOD.previous_page_number }}&page_group_info_list={{ group_info_list.number }}&page_group_infoMD={{ group_infoMD.number }}&page_group_infoFD={{ group_infoFD.number }}#preoral-details">&lsaquo;</a>
                                    {% endif %}
                                    <span class="current">
                                        Page {{ group_infoPOD.number }} of {{ group_infoPOD.paginator.num_pages }}
                                    </span>
                                    {% if group_infoPOD.has_next %}
                                        <a href="?page_group_infoPOD={{ group_infoPOD.next_page_number }}&page_group_info_list={{ group_info_list.number }}&page_group_infoMD={{ group_infoMD.number }}&page_group_infoFD={{ group_infoFD.number }}#preoral-details">&rsaquo;</a>
                                        <a href="?page_group_infoPOD={{ group_infoPOD.paginator.num_pages }}&page_group_info_list={{ group_info_list.number }}&page_group_infoMD={{ group_infoMD.number }}&page_group_infoFD={{ group_infoFD.number }}#preoral-details">&raquo;</a>
                                    {% endif %}
                                </span>
                            </div>
                            <a href="{% url 'checker2' %}" class="btn btn-secondary">View Pre-Oral Schedule</a>
                        </div>
                    </div>

                <!-- Mock Defense Details Table -->
                <div class="card mt-3 p-4 shadow-lg" id="mock-defense-details" style="display: none;">
                    <div id="mock-defense-details" class="details-section">
                        <h2 class="text-center mb-4 title-heading">Mock Defense Details</h2>
                        <div class="parent-container">
                            <input type="text" id="searchMockDefense" class="search-bar" placeholder="Search..." onkeyup="searchTable('mock-defense-details', 'searchMockDefense')">
                        </div>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Capstone Teacher</th>
                                    <th>Section</th>
                                    <th>Members</th>
                                    <th>Adviser</th>
                                    <th>Title</th>
                                    <th>Panelist</th>
                                    {% if selected_school_year == last_school_year %}
                                        <th>Action</th>
                                    {% endif %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for mgroup in group_infoMD %}
                                    <tr>
                                        <td data-label="Capstone Teacher">{{ mgroup.capstone_teacher.name }}</td>
                                        <td data-label="Section">{{ mgroup.section }}</td>
                                        <td data-label="Group Members">
                                            {{ mgroup.member1 }}<br />
                                            {{ mgroup.member2 }}<br />
                                            {{ mgroup.member3 }}
                                        </td>
                                        <td data-label="Adviser">{{ mgroup.adviser.name }}</td>
                                        <td data-label="Title">{{ mgroup.title }}</td>
                                        <td class="panels" data-label="Panelists">
                                            {% with schedule=group_schedules_md|get_item:mgroup.id %}
                                                {% if schedule %}
                                                <div style="background-color: #5b97f8; padding: 3px; display: inline-block; border-radius: 3px;font-weight: bold;">
                                                        {{ schedule.faculty1.name }} {% if schedule.faculty1 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                    </div>
                                                    <div style="padding: 3px;">
                                                        {{ schedule.faculty2.name }} {% if schedule.faculty2 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                    </div>
                                                    <div style="padding: 3px;">
                                                        {{ schedule.faculty3.name }} {% if schedule.faculty3 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                    </div>
                                                {% else %}
                                                    No panelists assigned
                                                {% endif %}
                                            {% endwith %}
                                        </td>
                                        {% if selected_school_year == last_school_year %}
                                            <td  class="btn"data-label="Action">
                                                <div style="display: flex; gap: 5px; justify-content: center;">
                                                    <button class="btn btn-warning btn-sm" data-toggle="modal" data-target="#editModal-MD-{{ mgroup.id }}" data-id="{{ mgroup.id }}">Edit</button>
                                                    <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deleteModal-MD-{{ mgroup.id }}" data-id="{{ mgroup.id }}">Delete</button>
                                                </div>
                                            </td>
                                        {% endif %}
                                    </tr>

                                    <!-- Edit Modal -->
                                    <div class="modal fade" id="editModal-MD-{{ mgroup.id }}" tabindex="-1" role="dialog" aria-labelledby="editModalLabel-MD-{{ mgroup.id }}" aria-hidden="true"data-backdrop="static" data-keyboard="false">
                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h3 class="modal-title" id="editModalLabel-MD-{{ mgroup.id }}">
                                                        <i class="fas fa-pencil-alt" style="color: #10B981; margin-right: 10px;"></i>Edit Group</h3>
                                                    {% comment %} <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button> {% endcomment %}
                                                </div>
                                                <div class="modal-body">
                                                    <form id="editFormMD-{{ mgroup.id }}" method="post" action="{% url 'update_groupMD' mgroup.id %}">
                                                        {% csrf_token %}
                                                        {% with md_forms|get_item:mgroup.id as form %}
                                                        <div class="form-group">
                                                            <label for="{{ form.member1.id_for_label }}">Member 1:</label>
                                                            {{ form.member1|add_class:"form-control" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.member2.id_for_label }}">Member 2:</label>
                                                            {{ form.member2|add_class:"form-control" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.member3.id_for_label }}">Member 3:</label>
                                                            {{ form.member3|add_class:"form-control" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.title.id_for_label }}">{{ form.title.label }}:</label>
                                                            {{ form.title|add_class:"form-control custom-textarea" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.capstone_teacher.id_for_label }}">{{ form.capstone_teacher.label }}:</label>
                                                            {{ form.capstone_teacher|add_class:"form-control" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.section.id_for_label }}">{{ form.section.label }}:</label>
                                                            {{ form.section|add_class:"form-control" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.adviser.id_for_label }}">{{ form.adviser.label }}:</label>
                                                            {{ form.adviser|add_class:"form-control" }}
                                                        </div>
                                                        {% endwith %}
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="resetForm({{ mgroup.id }}, 'MD')">Discard Changes</button>
                                                            <button type="submit" class="btn btn-modal">Apply Changes</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Delete Confirmation Modal -->
                                    <div class="modal fade" id="deleteModal-MD-{{ mgroup.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel-MD-{{ mgroup.id }}" aria-hidden="true"data-backdrop="static" data-keyboard="false">
                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title custom-3d-title" id="deleteModalLabel-MD-{{ mgroup.id }}">
                                                        <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i> Confirm Delete
                                                    </h5>
                                                    {% comment %} <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button> {% endcomment %}
                                                </div>
                                                <div class="modal-body">
                                                    Are you sure you want to delete this group?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">No, Keep it.</button>
                                                    <a href="{% url 'delete_groupMD' mgroup.id %}" class="btn btn-danger">Yes, Delete!</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </tbody>
                        </table>
                        <div class="pagination" id="pagination-group-info-MD">
                            <span class="step-links">
                                {% if group_infoMD.has_previous %}
                                    <a href="?page_group_infoMD=1&page_group_info_list={{ group_info_list.number }}&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoFD={{ group_infoFD.number }}">&laquo;</a>
                                    <a href="?page_group_infoMD={{ group_infoMD.previous_page_number }}&page_group_info_list={{ group_info_list.number }}&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoFD={{ group_infoFD.number }}">&lsaquo;</a>
                                {% endif %}
                                <span class="current">
                                    Page {{ group_infoMD.number }} of {{ group_infoMD.paginator.num_pages }}
                                </span>
                                {% if group_infoMD.has_next %}
                                    <a href="?page_group_infoMD={{ group_infoMD.next_page_number }}&page_group_info_list={{ group_info_list.number }}&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoFD={{ group_infoFD.number }}">&rsaquo;</a>
                                    <a href="?page_group_infoMD={{ group_infoMD.paginator.num_pages }}&page_group_info_list={{ group_info_list.number }}&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoFD={{ group_infoFD.number }}">&raquo;</a>
                                {% endif %}
                            </span>
                        </div>
                        <a href="{% url 'checker3' %}" class="btn btn-secondary">View Mock Defense Schedule</a>
                    </div>
                </div>
                
                <!-- Final Defense Details Table -->
                <div class="card mt-3 p-4 shadow-lg" id="final-defense-details" style="display: none;">
                    <div id="final-defense-details" class="details-section">
                        <h2 class="text-center mb-4 title-heading">Final Defense Details</h2>
                        <div class="parent-container">
                            <input type="text" id="searchFinalDefense" class="search-bar" placeholder="Search..." onkeyup="searchTable('final-defense-details', 'searchFinalDefense')">
                        </div>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Capstone Teacher</th>
                                    <th>Section</th>
                                    <th>Members</th>
                                    <th>Adviser</th>
                                    <th>Title</th>
                                    <th>Panelist</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for fgroup in group_infoFD %}
                                    <tr>
                                        <td data-label="Capstone Teacher">{{ fgroup.capstone_teacher.name }}</td>
                                        <td data-label="Section">{{ fgroup.section }}</td>
                                        <td data-label="Group Members">
                                            {{ fgroup.member1 }}<br />
                                            {{ fgroup.member2 }}<br />
                                            {{ fgroup.member3 }}
                                        </td>
                                        <td data-label="Adviser">{{ fgroup.adviser.name }}</td>
                                        <td>{{ fgroup.title }}</td>
                                        <td class="panels" data-label="Panelists">
                                            {% with schedule=group_schedules_fd|get_item:fgroup.id %}
                                                {% if schedule %}
                                                <div style="background-color: #5b97f8; padding: 3px; display: inline-block; border-radius: 3px;font-weight: bold;">
                                                        {{ schedule.faculty1.name }} {% if schedule.faculty1 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                    </div>
                                                    <div style="padding: 3px;">
                                                        {{ schedule.faculty2.name }} {% if schedule.faculty2 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                    </div>
                                                    <div style="padding: 3px;">
                                                        {{ schedule.faculty3.name }} {% if schedule.faculty3 == faculty_member %}<span class="role">(Panelist)</span>{% endif %}
                                                    </div>
                                                {% else %}
                                                    No panelists assigned
                                                {% endif %}
                                            {% endwith %}
                                        </td>
                                        <td class="btn" data-label="Action">
                                            <div style="display: flex; gap: 5px; justify-content: center;">
                                                <button class="btn btn-warning btn-sm" data-toggle="modal" data-target="#editModal-FD-{{ fgroup.id }}" data-id="{{ fgroup.id }}">Edit</button>
                                                <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deleteModal-FD-{{ fgroup.id }}" data-id="{{ fgroup.id }}">Delete</button>
                                            </div>
                                        </td>
                                    </tr>

                                    <!-- Edit Modal -->
                                    <div class="modal fade" id="editModal-FD-{{ fgroup.id }}" tabindex="-1" role="dialog" aria-labelledby="editModalLabel-FD-{{ fgroup.id }}" aria-hidden="true"data-backdrop="static" data-keyboard="false">
                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="editModalLabel-FD-{{ fgroup.id }}">
                                                        <i class="fas fa-pencil-alt" style="color: #10B981; margin-right: 10px;"></i>Edit Final Defense Group</h5>
                                                    {% comment %} <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button> {% endcomment %}
                                                </div>
                                                <div class="modal-body">
                                                    <form id="editFormFD-{{ fgroup.id }}" method="post" action="{% url 'update_groupFD' fgroup.id %}">
                                                        {% csrf_token %}
                                                        {% with fd_forms|get_item:fgroup.id as form %}
                                                        <div class="form-group">
                                                            <label for="{{ form.member1.id_for_label }}">Member 1:</label>
                                                            {{ form.member1|add_class:"form-control" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.member2.id_for_label }}">Member 2:</label>
                                                            {{ form.member2|add_class:"form-control" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.member3.id_for_label }}">Member 3:</label>
                                                            {{ form.member3|add_class:"form-control" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.title.id_for_label }}">{{ form.title.label }}:</label>
                                                            {{ form.title|add_class:"form-control custom-textarea" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.capstone_teacher.id_for_label }}">{{ form.capstone_teacher.label }}:</label>
                                                            {{ form.capstone_teacher|add_class:"form-control" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.section.id_for_label }}">{{ form.section.label }}:</label>
                                                            {{ form.section|add_class:"form-control" }}
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="{{ form.adviser.id_for_label }}">{{ form.adviser.label }}:</label>
                                                            {{ form.adviser|add_class:"form-control" }}
                                                        </div>
                                                        {% endwith %}
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="resetForm({{ fgroup.id }}, 'FD')">Discard Changes</button>
                                                            <button type="submit" class="btn btn-modal">Apply Changes</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Delete Confirmation Modal -->
                                    <div class="modal fade" id="deleteModal-FD-{{ fgroup.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel-FD-{{ fgroup.id }}" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title custom-3d-title" id="deleteModalLabel-FD-{{ fgroup.id }}">
                                                        <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i> Confirm Delete
                                                    </h5>
                                                    {% comment %} <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button> {% endcomment %}
                                                </div>
                                                <div class="modal-body">
                                                    Are you sure you want to delete this group?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">No, Keep it.</button>
                                                    <a href="{% url 'delete_groupFD' fgroup.id %}" class="btn btn-danger">Yes, Delete!</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </tbody>
                        </table>
                        <div class="pagination" id="pagination-group-info-FD">
                            <span class="step-links">
                                {% if group_infoFD.has_previous %}
                                    <a href="?page_group_infoFD=1&page_group_info_list={{ group_info_list.number }}&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoMD={{ group_infoMD.number }}">&laquo;</a>
                                    <a href="?page_group_infoFD={{ group_infoFD.previous_page_number }}&page_group_info_list={{ group_info_list.number }}&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoMD={{ group_infoMD.number }}">&lsaquo;</a>
                                {% endif %}
                                <span class="current">
                                    Page {{ group_infoFD.number }} of {{ group_infoFD.paginator.num_pages }}
                                </span>
                                {% if group_infoFD.has_next %}
                                    <a href="?page_group_infoFD={{ group_infoFD.next_page_number }}&page_group_info_list={{ group_info_list.number }}&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoMD={{ group_infoMD.number }}">&rsaquo;</a>
                                    <a href="?page_group_infoFD={{ group_infoFD.paginator.num_pages }}&page_group_info_list={{ group_info_list.number }}&page_group_infoPOD={{ group_infoPOD.number }}&page_group_infoMD={{ group_infoMD.number }}">&raquo;</a>
                                {% endif %}
                            </span>
                        </div>
                        <a href="{% url 'checker4' %}" class="btn btn-secondary">View Final Defense Schedule</a>
                    </div>
                </div>
            </main>
            <footer class="footer">
                {% include 'footer.html' %}
              </footer>
        </div>
      </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Restore the selected table from localStorage
            const savedTableId = localStorage.getItem('selectedTableId');
            if (savedTableId) {
                displaySelectedTableById(savedTableId);
                document.getElementById('groupSelector').value = savedTableId;
            }
    
            // Function to display the selected table
            function displaySelectedTableById(selectedId) {
                const tableContainers = document.querySelectorAll('.card');
    
                tableContainers.forEach(container => {
                    container.style.display = 'none';
                });
    
                if (selectedId) {
                    document.getElementById(selectedId).style.display = 'block';
                    localStorage.setItem('selectedTableId', selectedId);
                }
            }
    
            // Add event listener to the dropdown
            document.getElementById('groupSelector').addEventListener('change', function() {
                displaySelectedTableById(this.value);
            });
    
            // Pagination event listener
            document.querySelectorAll('.pagination a').forEach(function(paginationLink) {
                paginationLink.addEventListener('click', function() {
                    // Restore the selected table after pagination
                    const savedTableId = localStorage.getItem('selectedTableId');
                    if (savedTableId) {
                        displaySelectedTableById(savedTableId);
                        document.getElementById('groupSelector').value = savedTableId;
                    }
                });
            });
    
            // Fetch all data for each table
            fetchAllData('title-hearing-details', 'titleHearingBody');
            fetchAllData('preoral-details', 'preOralBody');
            fetchAllData('mock-defense-details', 'mockDefenseBody');
            fetchAllData('final-defense-details', 'finalDefenseBody');
        });
    
        function fetchAllData(tableId, tbodyId) {
            fetch(`/get_all_data/${tableId}/`)
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById(tbodyId);
                    tbody.innerHTML = '';
                    data.forEach(row => {
                        const tr = document.createElement('tr');
                        row.forEach(cell => {
                            const td = document.createElement('td');
                            td.textContent = cell;
                            tr.appendChild(td);
                        });
                        tbody.appendChild(tr);
                    });
                });
        }
    
        function searchTable(tableId, searchInputId) {
            const input = document.getElementById(searchInputId);
            const filter = input.value.toLowerCase();
            const table = document.getElementById(tableId);
            const rows = table.getElementsByTagName('tr');
    
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let match = false;
    
                for (let j = 0; j < cells.length; j++) {
                    if (cells[j]) {
                        const cellText = cells[j].textContent || cells[j].innerText;
                        if (cellText.toLowerCase().indexOf(filter) > -1) {
                            match = true;
                            break;
                        }
                    }
                }
    
                if (match) {
                    rows[i].style.display = '';
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }
    </script>
    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            if (window.location.hash) {
                const element = document.querySelector(window.location.hash);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth' });
                }
            }
    
            // Sidebar toggle functionality
            const sidebarToggle = document.getElementById("sidebarToggle");
            const sidebar = document.getElementById("sidebar");
    
            if (sidebarToggle) {
                sidebarToggle.addEventListener("click", function(event) {
                    event.preventDefault();
                    sidebar.classList.toggle("hidden");
    
                    // Store the sidebar state in localStorage
                    if (sidebar.classList.contains("hidden")) {
                        localStorage.setItem("sidebarState", "closed");
                    } else {
                        localStorage.setItem("sidebarState", "open");
                    }
                });
            }
    
            // Retrieve the sidebar state from localStorage
            const sidebarState = localStorage.getItem("sidebarState");
    
            // Apply the saved sidebar state (open/closed)
            if (sidebarState === "closed") {
                sidebar.classList.add("hidden"); // Keep sidebar closed if it was previously closed
            }
    
            // Dropdown functionality for sidebar list items
            document.querySelectorAll('.sidebar-dropdown > a').forEach(function(dropdownLink) {
                dropdownLink.addEventListener('click', function(event) {
                    event.preventDefault();
                    var parentLi = this.parentElement;
                    var dropdownMenu = parentLi.querySelector('.sidebar-submenu');
                    dropdownMenu.classList.toggle('hidden');
                });
            });
    
            // Dropdown functionality for sidebar list items with Bootstrap collapse
            document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(function(dropdownLink) {
                dropdownLink.addEventListener('click', function(event) {
                    event.preventDefault();
                    var target = document.querySelector(this.getAttribute('data-bs-target'));
                    target.classList.toggle('show');
                });
            });
    
            // New functionality for updating panelists
            function updatePanelists(groupId, teacherId) {
                fetch(`/get_panelists/${groupId}/${teacherId}/`)
                    .then(response => response.json())
                    .then(data => {
                        const panelistsElement = document.getElementById(`panelists-${groupId}`);
                        panelistsElement.innerHTML = data.panelists.join('<br>');
                    });
            }
    
            // Add event listeners to subject teacher select elements
            document.querySelectorAll('[id^="subject_teacher"]').forEach(function(select) {
                select.addEventListener('change', function() {
                    const groupId = this.id.split('-')[1];
                    updatePanelists(groupId, this.value);
                });
            });
        });
    </script>
    <script>
        function resetForm(id, type) {
            let formId;
            switch (type) {
                case 'POD':
                    formId = 'editFormPOD-' + id;
                    break;
                case 'MD':
                    formId = 'editFormMD-' + id;
                    break;
                case 'FD':
                    formId = 'editFormFD-' + id;
                    break;
                case 'TH':
                default:
                    formId = 'editFormTH-' + id;
                    break;
            }
            document.getElementById(formId).reset();
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const textareas = document.querySelectorAll('.custom-textarea');
            
            textareas.forEach(textarea => {
                textarea.style.height = 'auto';
                textarea.style.height = Math.max(textarea.scrollHeight, 150) + 'px';

                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.max(this.scrollHeight, 150) + 'px';
                });
            });
        });
    </script>
</body>
</html>